<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>1.3 QHTML Tutorial</TITLE><LINK href="ozdoc.css" rel="stylesheet" type="text/css"></HEAD><BODY><TABLE align="center" border="0" cellpadding="6" cellspacing="6" class="nav"><TR bgcolor="#DDDDDD"><TD><A href="node2.html#chapter.prototyper">&lt;&lt; Prev</A></TD><TD><A href="index.html">- Up -</A></TD><TD><A href="node4.html#chapter.geometry">Next &gt;&gt;</A></TD></TR></TABLE><DIV id="chapter.tutorial"><H2><A name="chapter.tutorial">1.3 QHTML Tutorial</A></H2><P>The example given in this chapter describes how a user interface is built using the QHTML module. The creation of the widgets, their geometry inside the window and their interaction with Mozart are described. </P><P></P><P></P><DIV id="figure.notepad.gif"><HR><P><A name="figure.notepad.gif"></A></P><DIV align="center"><IMG alt="" src="notepad.gif"></DIV><P class="caption"><STRONG>Figure&nbsp;1.2.</STRONG></P><HR></DIV><P></P><P></P><P></P><H3><A name="label4">1.3.1 Geometry management</A></H3><P></P><P>The example application will consist of a window composed by </P><P></P><P></P><UL><LI><P>A toolbar with the following buttons : Save, Load, a file selection button and Quit.</P><P></P></LI><LI><P>A main area where the user can type the text.</P></LI></UL><P>The construction of a window is completely described by a record. This record defines the widgets that compose the window, how these widgets must be placed and what is their behaviour upon window resizing. The label of the record defines the widget that must be placed. The content of the record defines the parameters of the widget. Some widgets act as containers for other widgets. The two main containers are : </P><P></P><P></P><UL><LI><P>td : all widgets contained in this one are placed top to down</P><P></P></LI><LI><P>lr : all widgets contained in this one are placed left to right</P></LI></UL><P>The toolbar is composed of button widgets and a file selection widget. The value parameter defines the text of the button. </P><P></P><P>The toolbar is described by :</P><P></P><BLOCKQUOTE class="code"><CODE>Toolbar=lr(button(value:<SPAN class="string">&quot;Save&quot;</SPAN>)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;button(value:<SPAN class="string">&quot;Load&quot;</SPAN>)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;button(value:<SPAN class="string">&quot;Quit&quot;</SPAN>))</CODE></BLOCKQUOTE><P></P><P>which literally means : place these four widgets buttons respectively from left to right, each widget taking the size it needs to display itself. Combining with the textarea widget, we obtain : </P><P></P><BLOCKQUOTE class="code"><CODE>Desc=toplevel(td(Toolbar<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;textarea))</CODE></BLOCKQUOTE><P></P><P>which literally means : inside the main window (<CODE>toplevel</CODE> widget), place the toolbar and the <CODE>textarea</CODE> respectively from top to bottom, each widget taking the size it needs to display itself.</P><P></P><P>Now we can build a window from this description by the command : </P><P></P><BLOCKQUOTE class="code"><CODE>Window={QHTML<SPAN class="keyword">.</SPAN>build&nbsp;Desc}</CODE></BLOCKQUOTE><P></P><P>This window is not displayed inside any Internet Browser by default. To open a new IE window and display the QHTML components inside it, execute :</P><P></P><BLOCKQUOTE class="code"><CODE>{Window&nbsp;show}</CODE></BLOCKQUOTE><P></P><P></P><DIV id="figure.tutorial_noglue.gif"><HR><P><A name="figure.tutorial_noglue.gif"></A></P><DIV align="center"><IMG alt="" src="Tutorial_noglue.gif"></DIV><P class="caption"><STRONG>Figure&nbsp;1.3.</STRONG></P><HR></DIV><P></P><P> </P><P>The result so far is not very good : widgets have a fixed size upon window resizing and don't fit as wanted.</P><P></P><P>One expects the toolbar to stick itself to the top left of the window, and the text widget to take all remaining available size below. All widgets have a glue parameter that allow to specify contraints to the geometry manager. Valid values for the glue parameters are atoms that are combinations of <CODE>n</CODE>, <CODE>s</CODE>, <CODE>w</CODE> and <CODE>e</CODE>. By default a widget takes as much place as it needs to draw itself, and if the area in which it is drawed is bigger than that size, the widget is centered inside. By specifying <CODE>n</CODE> (resp <CODE>s</CODE>, <CODE>w</CODE>, <CODE>e</CODE>) you enforce the north (resp south, west and east) border of the widget to glue to its top (resp down, left, right) neighboor. If you specify both <CODE>ns</CODE> (resp <CODE>we</CODE>) you enforce both opposite border to stick to their respective neighboor, resulting in the widget taking all the vertical (resp horizontal) space available.</P><P></P><P>Using the <CODE>glue</CODE> parameter we define : </P><P></P><BLOCKQUOTE class="code"><CODE>Toolbar=lr(glue:nwe<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;button(value:<SPAN class="string">&quot;Save&quot;</SPAN>&nbsp;glue:w)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;button(value:<SPAN class="string">&quot;Load&quot;</SPAN>&nbsp;glue:w)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file(glue:w)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;button(value:<SPAN class="string">&quot;Quit&quot;</SPAN>&nbsp;glue:e))</CODE></BLOCKQUOTE><P></P><P>and also </P><P></P><BLOCKQUOTE class="code"><CODE>Desc=toplevel(td(glue:nswe<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Toolbar<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;textarea(glue:nswe)))</CODE></BLOCKQUOTE><P></P><P>Rebuilding and showing the window, we obtain an application that has a complete graphical user interface, except that it is an empty shell.</P><P></P><P></P><H3><A name="label5">1.3.2 Interaction with the user</A></H3><P></P><P>An action can be associated to buttons. It is executed when the user clicks the button :</P><P></P><BLOCKQUOTE class="code"><CODE>button(value:<SPAN class="string">&quot;Click&quot;</SPAN>&nbsp;action:OzProcedure)</CODE></BLOCKQUOTE><P></P><P>We can define procedures for the three buttons of the application. The <CODE>Load</CODE> and <CODE>Save</CODE> procedures will take the name selected in the <CODE>file</CODE> widget and load it into the <CODE>textarea</CODE> widget or save its content. </P><P></P><P>We need a way to dynamically get the state of the <CODE>file</CODE> widget to get the selected name, and a way to change or get the contents of the <CODE>textarea</CODE> widget. This can be achieved by using <CODE>handle</CODE> parameters : when the window is built, variables specified as <CODE>handle</CODE> parameters are bound to Oz objects controlling the corresponding widget. The modified code now looks like :</P><P></P><BLOCKQUOTE class="code"><CODE>FH&nbsp;<SPAN class="comment">%&nbsp;FileHandler<BR></SPAN>TAH&nbsp;<SPAN class="comment">%&nbsp;TextAreaHandler<BR></SPAN>&nbsp;<BR>Toolbar=lr(glue:nwe<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;button(value:<SPAN class="string">&quot;Save&quot;</SPAN>&nbsp;glue:w&nbsp;action:Save)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;button(value:<SPAN class="string">&quot;Load&quot;</SPAN>&nbsp;glue:w&nbsp;action:Load)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file(glue:w&nbsp;handle:FH)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;button(value:<SPAN class="string">&quot;Quit&quot;</SPAN>&nbsp;glue:e&nbsp;action:Quit))<BR>&nbsp;<BR>Desc=toplevel(td(glue:nswe<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Toolbar<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;textarea(glue:nswe&nbsp;handle:TAH)))</CODE></BLOCKQUOTE><P></P><P>When the window is built, the contents of the textarea widget can be obtained by :</P><P></P><BLOCKQUOTE class="code"><CODE>{TAH&nbsp;get(value:$)}</CODE></BLOCKQUOTE><P></P><P>and set by : </P><P></P><BLOCKQUOTE class="code"><CODE>{TAH&nbsp;set($)}</CODE></BLOCKQUOTE><P></P><P>The selected file in the <CODE>file</CODE> widget can be obtained by :</P><P></P><BLOCKQUOTE class="code"><CODE>{FH&nbsp;get($)}</CODE></BLOCKQUOTE><P></P><P>Here are the definitions of the three procedures defined as <CODE>action</CODE> by the buttons :</P><P></P><BLOCKQUOTE class="code"><CODE><SPAN class="keyword">proc</SPAN>{<SPAN class="functionname">Save</SPAN>}<BR>&nbsp;&nbsp;&nbsp;<SPAN class="keyword">try</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File={New&nbsp;Open<SPAN class="keyword">.</SPAN>file&nbsp;init(name:{FH&nbsp;get(value:$)}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flags:[write&nbsp;create&nbsp;truncate])}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{File&nbsp;write(vs:{TAH&nbsp;get(value:$)})}<BR>&nbsp;&nbsp;&nbsp;<SPAN class="keyword">in</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{File&nbsp;close}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Window&nbsp;alert(<SPAN class="string">&quot;File&nbsp;successfully&nbsp;saved.&quot;</SPAN>)}<BR>&nbsp;&nbsp;&nbsp;<SPAN class="keyword">catch</SPAN>&nbsp;_&nbsp;<SPAN class="keyword">then</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Window&nbsp;alert(<SPAN class="string">&quot;Unable&nbsp;to&nbsp;save&nbsp;file.&quot;</SPAN>)}<BR>&nbsp;&nbsp;&nbsp;<SPAN class="keyword">end</SPAN>&nbsp;&nbsp;&nbsp;&nbsp;<BR><SPAN class="keyword">end</SPAN>&nbsp;<BR>&nbsp;<BR><SPAN class="keyword">proc</SPAN>{<SPAN class="functionname">Load</SPAN>}<BR>&nbsp;&nbsp;&nbsp;<SPAN class="keyword">try</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File={New&nbsp;Open<SPAN class="keyword">.</SPAN>file&nbsp;init(name:{FH&nbsp;get(value:$)})}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Data={File&nbsp;read(list:$&nbsp;size:all)}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{File&nbsp;close}<BR>&nbsp;&nbsp;&nbsp;<SPAN class="keyword">in</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{TAH&nbsp;set(value:Data)}<BR>&nbsp;&nbsp;&nbsp;<SPAN class="keyword">catch</SPAN>&nbsp;_&nbsp;<SPAN class="keyword">then</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Window&nbsp;alert(<SPAN class="string">&quot;Unable&nbsp;to&nbsp;load&nbsp;file.&nbsp;Check&nbsp;if&nbsp;specified&nbsp;file&nbsp;exists.&quot;</SPAN>)}<BR>&nbsp;&nbsp;&nbsp;<SPAN class="keyword">end</SPAN>&nbsp;<BR><SPAN class="keyword">end</SPAN>&nbsp;<BR>&nbsp;<BR><SPAN class="keyword">proc</SPAN>{<SPAN class="functionname">Quit</SPAN>}<BR>&nbsp;&nbsp;&nbsp;{Window&nbsp;close}<BR><SPAN class="keyword">end</SPAN></CODE></BLOCKQUOTE><P></P><P>The application is now complete ! <A href="Demo.oz">Here</A> is the full code.</P><P></P><P> </P></DIV><TABLE align="center" border="0" cellpadding="6" cellspacing="6" class="nav"><TR bgcolor="#DDDDDD"><TD><A href="node2.html#chapter.prototyper">&lt;&lt; Prev</A></TD><TD><A href="index.html">- Up -</A></TD><TD><A href="node4.html#chapter.geometry">Next &gt;&gt;</A></TD></TR></TABLE><HR><ADDRESS>Donatien Grolaux<BR><SPAN class="version">Version 1.3.0 (20010902)</SPAN></ADDRESS></BODY></HTML>
