<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>2.4 QHTML Manual : Internet Browser connection</TITLE><LINK href="ozdoc.css" rel="stylesheet" type="text/css"></HEAD><BODY><TABLE align="center" border="0" cellpadding="6" cellspacing="6" class="nav"><TR bgcolor="#DDDDDD"><TD><A href="node6.html#chapter.events">&lt;&lt; Prev</A></TD><TD><A href="index.html">- Up -</A></TD><TD><A href="node8.html#chapter.look">Next &gt;&gt;</A></TD></TR></TABLE><DIV id="chapter.browser"><H2><A name="chapter.browser">2.4 QHTML Manual : Internet Browser connection</A></H2><P>QHTML displays the user interface using an Internet browser. So far all examples started a browser locally :</P><P></P><BLOCKQUOTE class="code"><CODE>{{QHTML<SPAN class="keyword">.</SPAN>build&nbsp;toplevel(label(value:<SPAN class="string">&quot;Hello&nbsp;world&quot;</SPAN>))}&nbsp;show}</CODE></BLOCKQUOTE><P></P><P>This is a facility of QHTML, not a limitation. QHTML windows can be connected to Internet browsers in many different ways, so that the user interface can be in a remote location from the QHTML running site.</P><P></P><P></P><H3><A name="label10">2.4.1 QHTML-Internet browser connection</A></H3><P></P><P></P><P></P><DIV id="figure.qhtml.gif"><HR><P><A name="figure.qhtml.gif"></A></P><DIV align="center"><IMG alt="" src="qhtml.gif"></DIV><P class="caption"><STRONG>Figure&nbsp;2.8.</STRONG></P><HR></DIV><P></P><P></P><P>The connection between QHTML and an Internet browser requires :</P><P></P><UL><LI><P>An Oz application listening to a socket that will accept connections from outer world.</P><P></P></LI><LI><P>A web page that loads the QHTML Java applet. This applet connects to the socket of the Oz application to create a communication stream between the browser and the QHTML window. This Java applet is distributed with the sources of QHTML, or by the QHTML internal web server. The web page that loads this applet can be automatically created by QHTML.</P><P></P></LI></UL><P>QHTML sends JavaScript commands to be executed at the browser side. Dynamic HTML is used to configure and interact with the browser.</P><P></P><P>The <CODE>show</CODE> method of a QHTML <CODE>toplevel</CODE> widget is a shortcut to start a local Internet browser and make it load the Java applet that will connect to the QHTML window.</P><P></P><P>Note that the Java applet must be configured so that it knows where it must connect, eg it needs to know the ip adress and port number of the listening socket of the Oz application. </P><P></P><P>To avoid the requirement of a web server, QHTML has a simplified web server built in that can serve the starting page and Java applet required by itself to work. This web server can automatically configure the served files to match the ip and port selected for the connection. A web page can be created to redirect (change the page displayed inside) the browser to the URL of the QHTML web server. This page can be placed anywhere, including public web servers, to create an entry point with a fixed URL to the QHTML application.</P><P></P><P>QHTML windows at the Oz side can live indifferently connected or not to an Internet browser. This is a simplification for the application development as the developer has not to worry of the connection state of the window, at least most of the time. Note that under some circonstances, QHTML might return <CODE>QHTML<SPAN class="keyword">.</SPAN>undefined</CODE> when asked for some state of the user interface (that is mainly but not limited to <CODE>get</CODE> method calls). QHTML applications should always expect this return value and take proper actions accordingly (ignore the return value and discard the operation, try again later, log an error, ...) Note that the same command might successively return <CODE>QHTML<SPAN class="keyword">.</SPAN>undefined</CODE> and the expected value under some (rare) circumstances. Note that QHTML might return <CODE>QHTML<SPAN class="keyword">.</SPAN>undefined</CODE> even if it is correctly connected to a browser. The rule of thumb is : QHTML always returns the asked value <EM>if it was able to determine it</EM>, otherwise it returns <CODE>QHTML<SPAN class="keyword">.</SPAN>undefined</CODE>. Possible cause where QHTML cannot determine the asked value (not exhaustive) : the browser returned <CODE>undefined</CODE> or another error code; a disconnection was detected after the value was asked to the browser, but before it answered to QHTML; a state with no default that was never set to any value and QHTML is not connected to a browser; a state that only the browser can know the value and QHTML is not connected to a browser.</P><P></P><P>QHTML windows can be successively connected to different browsers. One QHTML window can be connected to zero or one browser window at a time. The state of the window is monitored by QHTML so that its state persists from connection to connection. However for effeciency reasons, this monitoring cannot be garanteed to be acurate in all situations. For example, if the browser crashes, it is the last known by QHTML state of widgets that will be used when building the user interface upon a new connection.</P><P></P><P></P><H3><A name="label11">2.4.2 QHTML connection procedures</A></H3><P></P><P></P><P>There are two types of server QHTML can create:</P><P></P><UL><LI><P>QHTML connection server: the Java applet connects to this server. A communication object is created at the Oz side by the QHTML connection server for a bidirectional communication between the Oz process and the Internet Browser. A QHTML window can be connected to that browser by : <CODE>{QHTMLWindow&nbsp;connect(ComObj)}</CODE> where <CODE>QHTMLWindow</CODE> is a window object built by <CODE>QHTML<SPAN class="keyword">.</SPAN>build</CODE>, and <CODE>ComObj</CODE> is the communication object corresponding to the Internet Browser.</P><P></P></LI><LI><P>Web server: provides the index page and the QHTML java applet to the Internet Browser.</P><P></P></LI></UL><P>QHTML server management procedures:</P><P></P><UL><LI><P><CODE><SPAN class="keyword">fun</SPAN>{<SPAN class="functionname">QHTML.startServer</SPAN>&nbsp;P}</CODE>: starts a QHTML connection server on a free port and returns its number. <CODE>P</CODE> is a one parameter procedure that is called each time a connection is created by the server. This procedure parameter is the communication object to the Internet Browser. For example <CODE>P</CODE> could be :</P><P></P><BLOCKQUOTE class="code"><CODE><SPAN class="keyword">proc</SPAN>{<SPAN class="functionname">$</SPAN>&nbsp;ComObj}<BR>&nbsp;&nbsp;&nbsp;Window={QHTML<SPAN class="keyword">.</SPAN>build&nbsp;someDescription}<BR><SPAN class="keyword">in</SPAN>&nbsp;<BR>&nbsp;&nbsp;&nbsp;{Window&nbsp;connect(ComObj)}<BR><SPAN class="keyword">end</SPAN></CODE></BLOCKQUOTE><P></P><P></P></LI><LI><P><CODE><SPAN class="keyword">proc</SPAN>{<SPAN class="functionname">QHTML.startServerOnPort</SPAN>&nbsp;N&nbsp;P}</CODE>: same as above, but force the use of the port number <CODE>N</CODE>.</P><P></P></LI><LI><P><CODE><SPAN class="keyword">proc</SPAN>{<SPAN class="functionname">QHTML.stopServer</SPAN>&nbsp;N}</CODE>: stops the connection server that uses the port number <CODE>N</CODE>.</P><P></P></LI><LI><P><CODE><SPAN class="keyword">fun</SPAN>{<SPAN class="functionname">QHTML.startWebServer</SPAN>&nbsp;N}</CODE>: starts a web server on a free port and returns its number. The Java applet is configured to use the port number <CODE>N</CODE>, eg the port returned by <CODE>QHTML<SPAN class="keyword">.</SPAN>startServer</CODE>, or the one specfied by <CODE>QHTML<SPAN class="keyword">.</SPAN>startServerOnPort</CODE>.</P><P></P></LI><LI><P><CODE><SPAN class="keyword">proc</SPAN>{<SPAN class="functionname">QHTML.startWebServerOnPort</SPAN>&nbsp;N&nbsp;M}</CODE>: same as above, but force the use of the port number <CODE>M</CODE> for this server.</P><P></P></LI><LI><P><CODE><SPAN class="keyword">proc</SPAN>{<SPAN class="functionname">QHTML.stopWebServer</SPAN>&nbsp;M}</CODE>: stops the web server that uses the port number <CODE>M</CODE>.</P><P></P></LI><LI><P><CODE><SPAN class="keyword">proc</SPAN>{<SPAN class="functionname">QHTML.startAll</SPAN>&nbsp;P&nbsp;N&nbsp;M}</CODE>: shortcut to start a connection server on port <CODE>N</CODE> that uses the connection procedure <CODE>P</CODE> and a web server on port <CODE>M</CODE> with one command.</P><P></P></LI><LI><P><CODE><SPAN class="keyword">proc</SPAN>{<SPAN class="functionname">QHTML.startAllHTMLEntryFilename</SPAN>&nbsp;P&nbsp;F}</CODE>: starts a connection server that uses the connection procedure <CODE>P</CODE> and a web server. A redirector web page is created and saved to the file <CODE>F</CODE>. This is the simplest way to make a QHTML application available from a computer that has no fixed web address : upload the file <CODE>F</CODE> to a web server to make it available from a fixed URL each time you run the application, and use that adress to use the application from an Internet Browser.</P><P></P></LI></UL><P></P><P> </P></DIV><TABLE align="center" border="0" cellpadding="6" cellspacing="6" class="nav"><TR bgcolor="#DDDDDD"><TD><A href="node6.html#chapter.events">&lt;&lt; Prev</A></TD><TD><A href="index.html">- Up -</A></TD><TD><A href="node8.html#chapter.look">Next &gt;&gt;</A></TD></TR></TABLE><HR><ADDRESS>Donatien Grolaux<BR><SPAN class="version">Version 1.3.0 (20010902)</SPAN></ADDRESS></BODY></HTML>
